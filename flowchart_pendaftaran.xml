<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="app.diagrams.net" modified="2025-01-01T00:00:00.000Z" agent="draw.io" version="20.8.10" type="device">
  <diagram id="main" name="Flowchart Pendaftaran">
    <mxGraphModel dx="1430" dy="987" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1200" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- Swimlanes -->
        <mxCell id="feLane" value="Frontend" style="swimlane;childLayout=stackLayout;horizontal=1;startSize=30;" parent="1" vertex="1">
          <mxGeometry x="0" y="0" width="780" height="1120" as="geometry"/>
        </mxCell>
        <mxCell id="beLane" value="Backend" style="swimlane;childLayout=stackLayout;horizontal=1;startSize=30;" parent="1" vertex="1">
          <mxGeometry x="820" y="0" width="780" height="1120" as="geometry"/>
        </mxCell>

        <!-- Frontend nodes -->
        <mxCell id="fe_start" value="User buka form registrasi" style="ellipse;whiteSpace=wrap;" parent="feLane" vertex="1">
          <mxGeometry x="60" y="40" width="220" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="fe_fill" value="Isi data + pilih kategori tiket" style="rounded=1;whiteSpace=wrap;" parent="feLane" vertex="1">
          <mxGeometry x="60" y="130" width="260" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="fe_voucher_check" value="Request /voucher/check" style="rounded=1;whiteSpace=wrap;" parent="feLane" vertex="1">
          <mxGeometry x="60" y="230" width="250" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="fe_display" value="Tampilkan harga final (termasuk Rp0)" style="rounded=1;whiteSpace=wrap;" parent="feLane" vertex="1">
          <mxGeometry x="60" y="330" width="300" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="fe_submit" value="Klik Submit" style="rounded=1;whiteSpace=wrap;" parent="feLane" vertex="1">
          <mxGeometry x="60" y="430" width="180" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="fe_dup_resp" value="Respons 409 (duplicate pending) ?" style="rhombus;whiteSpace=wrap;" parent="feLane" vertex="1">
          <mxGeometry x="60" y="520" width="260" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="fe_resume" value="Opsional: tawarkan lanjutkan pembayaran lama (/registration/resume)" style="rounded=1;whiteSpace=wrap;" parent="feLane" vertex="1">
          <mxGeometry x="60" y="620" width="320" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="fe_success" value="Terima respons 201 (registrasi baru)" style="rounded=1;whiteSpace=wrap;" parent="feLane" vertex="1">
          <mxGeometry x="60" y="720" width="260" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="fe_price_branch" value="Harga final = 0 ?" style="rhombus;whiteSpace=wrap;" parent="feLane" vertex="1">
          <mxGeometry x="60" y="820" width="200" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="fe_skip" value="Tampilkan sukses + e-ticket (tanpa Midtrans)" style="rounded=1;whiteSpace=wrap;" parent="feLane" vertex="1">
          <mxGeometry x="60" y="930" width="300" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="fe_midtrans" value="Redirect ke payment_url baru" style="rounded=1;whiteSpace=wrap;" parent="feLane" vertex="1">
          <mxGeometry x="380" y="930" width="260" height="70" as="geometry"/>
        </mxCell>

        <!-- Backend nodes -->
        <mxCell id="be_store" value="POST /api/registration" style="rounded=1;whiteSpace=wrap;" parent="beLane" vertex="1">
          <mxGeometry x="60" y="40" width="260" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="be_validate_event" value="Validasi event + category_ticket_type + periode" style="rounded=1;whiteSpace=wrap;" parent="beLane" vertex="1">
          <mxGeometry x="60" y="130" width="340" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="be_quota" value="Lock category_ticket_type &amp; cek quota (pending/confirmed/paid)" style="rounded=1;whiteSpace=wrap;" parent="beLane" vertex="1">
          <mxGeometry x="60" y="230" width="360" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="be_duplicate" value="Registrasi aktif ditemukan?" style="rhombus;whiteSpace=wrap;" parent="beLane" vertex="1">
          <mxGeometry x="60" y="330" width="280" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="be_override" value="Hapus/override pending lama atau tolak jika sudah confirmed" style="rounded=1;whiteSpace=wrap;" parent="beLane" vertex="1">
          <mxGeometry x="60" y="430" width="360" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="be_voucher" value="Validasi voucher (category match, valid date, confirmedRegistrations, lockForUpdate)" style="rounded=1;whiteSpace=wrap;" parent="beLane" vertex="1">
          <mxGeometry x="60" y="520" width="420" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="be_tx" value="DB Transaction: create/override registrasi + assign voucher + generate QR bila final_price=0" style="rounded=1;whiteSpace=wrap;" parent="beLane" vertex="1">
          <mxGeometry x="60" y="630" width="430" height="110" as="geometry"/>
        </mxCell>
        <mxCell id="be_price_branch" value="Final price = 0 ?" style="rhombus;whiteSpace=wrap;" parent="beLane" vertex="1">
          <mxGeometry x="60" y="760" width="200" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="be_skip_flow" value="Update status confirmed/paid + kirim e-ticket + mark voucher single-use" style="rounded=1;whiteSpace=wrap;" parent="beLane" vertex="1">
          <mxGeometry x="60" y="870" width="360" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="be_midtrans_link" value="Generate Midtrans link &amp; kirim email instruksi" style="rounded=1;whiteSpace=wrap;" parent="beLane" vertex="1">
          <mxGeometry x="470" y="870" width="320" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="be_webhook" value="Webhook Midtrans (signature check, lock registrasi, idempotent)" style="rounded=1;whiteSpace=wrap;" parent="beLane" vertex="1">
          <mxGeometry x="60" y="980" width="480" height="100" as="geometry"/>
        </mxCell>

        <!-- FE edges -->
        <mxCell id="fe_e1" edge="1" source="fe_start" target="fe_fill" style="endArrow=block"/>
        <mxCell id="fe_e2" edge="1" source="fe_fill" target="fe_voucher_check" style="endArrow=block"/>
        <mxCell id="fe_e3" edge="1" source="fe_voucher_check" target="fe_display" style="endArrow=block"/>
        <mxCell id="fe_e4" edge="1" source="fe_display" target="fe_submit" style="endArrow=block"/>
        <mxCell id="fe_e5" edge="1" source="fe_submit" target="fe_dup_resp" style="endArrow=block"/>
        <mxCell id="fe_e6" edge="1" source="fe_dup_resp" target="fe_resume" style="endArrow=block" value="Ya"/>
        <mxCell id="fe_e7" edge="1" source="fe_dup_resp" target="fe_success" style="endArrow=block" value="Tidak / override berhasil"/>
        <mxCell id="fe_e8" edge="1" source="fe_success" target="fe_price_branch" style="endArrow=block"/>
        <mxCell id="fe_e9" edge="1" source="fe_price_branch" target="fe_skip" style="endArrow=block" value="Ya"/>
        <mxCell id="fe_e10" edge="1" source="fe_price_branch" target="fe_midtrans" style="endArrow=block" value="Tidak"/>

        <!-- BE edges -->
        <mxCell id="be_e1" edge="1" source="be_store" target="be_validate_event" style="endArrow=block"/>
        <mxCell id="be_e2" edge="1" source="be_validate_event" target="be_quota" style="endArrow=block"/>
        <mxCell id="be_e3" edge="1" source="be_quota" target="be_duplicate" style="endArrow=block"/>
        <mxCell id="be_e4" edge="1" source="be_duplicate" target="be_override" style="endArrow=block" value="Ya"/>
        <mxCell id="be_e5" edge="1" source="be_override" target="be_voucher" style="endArrow=block"/>
        <mxCell id="be_e6" edge="1" source="be_duplicate" target="be_voucher" style="endArrow=block" value="Tidak"/>
        <mxCell id="be_e7" edge="1" source="be_voucher" target="be_tx" style="endArrow=block"/>
        <mxCell id="be_e8" edge="1" source="be_tx" target="be_price_branch" style="endArrow=block"/>
        <mxCell id="be_e9" edge="1" source="be_price_branch" target="be_skip_flow" style="endArrow=block" value="0"/>
        <mxCell id="be_e10" edge="1" source="be_price_branch" target="be_midtrans_link" style="endArrow=block" value="&gt; 0"/>
        <mxCell id="be_e11" edge="1" source="be_skip_flow" target="be_webhook" style="endArrow=block" value="Notif selesai"/>
        <mxCell id="be_e12" edge="1" source="be_midtrans_link" target="be_webhook" style="endArrow=block" value="Pembayaran sukses"/>

        <!-- Cross connections -->
        <mxCell id="cross1" edge="1" source="fe_voucher_check" target="be_voucher" style="endArrow=block" value="API /voucher/check"/>
        <mxCell id="cross2" edge="1" source="fe_submit" target="be_store" style="endArrow=block" value="API /registration"/>
        <mxCell id="cross3" edge="1" source="fe_resume" target="be_duplicate" style="endArrow=block" value="/registration/resume (opsional)"/>
        <mxCell id="cross4" edge="1" source="be_skip_flow" target="fe_skip" style="endArrow=block" value="Response 201 + e-ticket"/>
        <mxCell id="cross5" edge="1" source="be_midtrans_link" target="fe_midtrans" style="endArrow=block" value="payment_url baru"/>
        <mxCell id="cross6" edge="1" source="be_webhook" target="fe_skip" style="endArrow=block" value="Webhook (paid) kirim e-ticket"/>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
